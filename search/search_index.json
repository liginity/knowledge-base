{"config":{"lang":["en","zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u4e3b\u9875","text":"<p>\u8fd9\u91cc\u662f\u6211\u7684\u77e5\u8bc6\u5e93\u3002\u76ee\u524d\u8ba1\u5212\u8bb0\u5f55\u4e00\u4e9b\u5b9e\u8df5\u65b9\u9762\u7684\u77e5\u8bc6\u3002</p>"},{"location":"software/","title":"\u8f6f\u4ef6\u77e5\u8bc6","text":"<p>\u6709\u65f6\u5019\uff0c\u6211\u4f1a\u5fd8\u8bb0\u4e00\u4e9b\u8f6f\u4ef6\u7684\u4f7f\u7528\u65b9\u6cd5\u548c\u7ec6\u8282\u3002\u6211\u5e0c\u671b\u8bb0\u5f55\u4e00\u4e9b\u5185\u5bb9\uff0c\u4ee5\u65b9\u4fbf\u67e5\u627e\u3002</p>"},{"location":"software/qemu/passthrough-usb/","title":"\u7ed9 qemu \u865a\u62df\u673a\u76f4\u901a usb \u8bbe\u5907","text":"<p>\u7ed9 qemu \u865a\u62df\u673a\u76f4\u901a\u5bbf\u4e3b\u673a\u7684 usb \u8bbe\u5907\uff0c\u53ef\u4ee5\u8ba9\u865a\u62df\u673a\u76f4\u63a5\u8bbf\u95ee U \u76d8\u3001\u6444\u50cf\u5934\u7b49\u7269\u7406\u8bbe\u5907\u3002</p> <p>\u4e0b\u9762\u7684\u6b65\u9aa4\u63cf\u8ff0\u4e86\u7ed9\u865a\u62df\u673a\u76f4\u901a\u4e00\u4e2a U \u76d8\u7684\u8fc7\u7a0b\u3002</p> <ol> <li>\u83b7\u5f97 usb \u8bbe\u5907\u7684\u8bbf\u95ee\u6743\u9650<ol> <li>\u628a usb \u8bbe\u5907\u7684\u6240\u6709\u8005\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7528\u6237</li> <li>\u7528 root \u6743\u9650\u8fd0\u884c qemu</li> </ol> </li> <li>\u8bbe\u7f6e\u5408\u9002\u7684 qemu \u53c2\u6570\u5e76\u542f\u52a8\u865a\u62df\u673a</li> </ol> <p>\u5bf9\u4e8e\u6b65\u9aa4 1\uff0c\u4e0b\u9762\u9009\u62e9\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff1a\u627e\u5230 usb \u8bbe\u5907\u7684\u8def\u5f84\uff0c\u5e76\u628a\u6587\u4ef6\u7684\u6240\u6709\u8005\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7528\u6237\u3002</p>"},{"location":"software/qemu/passthrough-usb/#usb","title":"\u83b7\u5f97 usb \u8bbe\u5907\u7684\u8bbf\u95ee\u6743\u9650","text":""},{"location":"software/qemu/passthrough-usb/#u","title":"\u627e\u5230 U \u76d8\u7684\u8bbe\u5907\u8def\u5f84","text":"<p>\u5728 Linux \u4e0a\u63d2\u5165\u4e00\u4e2a U \u76d8\u65f6\uff0c\u4e00\u822c\u5bb9\u6613\u770b\u5230\u4e00\u4e2a\u65b0\u7684\u5757\u8bbe\u5907\uff0c\u6bd4\u5982 <code>/dev/sda</code> \u6216\u8005 <code>/dev/sdb</code>\u3002\u4f46\u662f\u8fd9\u5e76\u4e0d\u662f usb \u8bbe\u5907\u672c\u8eab\u3002</p> <p>\u901a\u8fc7 <code>lsusb</code> \u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u4e0a\u7684 usb \u8bbe\u5907\u7684\u4fe1\u606f\u3002 <pre><code>$ lsusb\nBus 007 Device 003: ID 17ef:608c Lenovo USB Keyboard\nBus 001 Device 004: ID 17ef:608d Lenovo Optical Mouse\nBus 001 Device 005: ID 0930:6544 Toshiba Corp. TransMemory-Mini XXX 2.0 Stick\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n</code></pre></p> <ul> <li>\u7531\u6b64\u53ef\u77e5\uff0cU \u76d8\u5728 bus 001\uff0cdevice 005 \u7684\u4f4d\u7f6e\u3002</li> <li>\u53ef\u4ee5\u5728 <code>/dev/bus/usb/</code> \u76ee\u5f55\u4e2d\u627e\u5230\u8fd9\u4e2a\u8bbe\u5907\uff0c\u5c31\u662f <code>/dev/bus/usb/001/005</code>\u3002\u901a\u8fc7 <code>udevadm info /dev/bus/usb/001/005</code> \u53ef\u4ee5\u786e\u8ba4\u8fd9\u4e2a\u8def\u5f84\u6307\u4ee3\u7684\u8bbe\u5907\u662f\u8fd9\u4e2a U \u76d8\u3002</li> <li>\u5728 ID <code>0930:6544</code> \u4e2d\uff0c<code>0930</code> \u662f U \u76d8\u7684 vendor id\uff0c<code>6544</code> \u662f product id\u3002</li> </ul>"},{"location":"software/qemu/passthrough-usb/#u_1","title":"\u8bbe\u7f6e U \u76d8\u8bbe\u5907\u7684\u6240\u6709\u8005","text":"<pre><code>sudo chown userAAA /dev/bus/usb/001/005\n</code></pre>"},{"location":"software/qemu/passthrough-usb/#qemu","title":"\u8bbe\u7f6e qemu \u53c2\u6570","text":"<p>\u4e3a\u4e86\u76f4\u901a\u524d\u8ff0 U \u76d8\u8bbe\u5907\uff0c\u5728 qemu \u547d\u4ee4\u4e2d\u6dfb\u52a0\u8fd9\u4e9b\u53c2\u6570 <pre><code>-usb -device usb-host,vendorid=0x0930,productid=0x6544\n</code></pre></p> <ul> <li><code>-usb</code>\uff1a\u4e3a\u865a\u62df\u673a\u5f00\u542f USB \u6a21\u62df\u529f\u80fd\u3002</li> <li><code>vendorid=0x0930,productid=0x6544</code>\uff1a\u4e0a\u9762\u627e\u5230\u4e86 U \u76d8\u7684 vendor id \u548c product id\uff0c\u4f9d\u6b21\u586b\u5165\u3002</li> </ul>"},{"location":"software/qemu/passthrough-usb/#_1","title":"\u66f4\u591a\u4fe1\u606f","text":""},{"location":"software/qemu/passthrough-usb/#devsda-usb","title":"\u63a2\u7d22\u5757\u8bbe\u5907 <code>/dev/sda</code> \u548c usb \u8bbe\u5907\u7684\u5173\u7cfb","text":"<p>\u5728\u7cfb\u7edf\u4e0a\u63d2\u5165\u4e00\u5757 U \u76d8\uff0c\u5bb9\u6613\u770b\u5230\u7c7b\u4f3c <code>/dev/sda</code> \u7684\u5757\u8bbe\u5907\u3002\u4ece\u5757\u8bbe\u5907\u53ef\u4ee5\u627e\u51fa usb \u8bbe\u5907\u7684\u4fe1\u606f\u3002</p> <p>\u901a\u8fc7 <code>udevadm info /dev/sda</code> \u53ef\u4ee5\u770b\u5230\u8bbe\u5907\u7684\u4fe1\u606f\u3002 <pre><code>$ udevadm info /dev/sda\nP: /devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda\nM: sda\nU: block\nT: disk\nD: b 8:0\nN: sda\nL: 0\nS: disk/by-id/usb-TOSHIBA_TransMemory_8BCAA96A7EEBCE80907A4D62-0:0\nS: disk/by-path/pci-0000:65:00.3-usb-0:1:1.0-scsi-0:0:0:0\nS: disk/by-diskseq/21\nQ: 21\nE: DEVPATH=/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda\nE: DEVNAME=/dev/sda\nE: DEVTYPE=disk\nE: DISKSEQ=21\nE: MAJOR=8\nE: MINOR=0\nE: SUBSYSTEM=block\n......\n</code></pre> \u4ece\u8bbe\u5907\u7684 path <code>/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda</code> \u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4e0e <code>usb1/1-1</code> \u6709\u5173\u7cfb\u3002</p> <p>\u901a\u8fc7 <code>udevadm info -a</code> \u53ef\u4ee5\u6253\u5370\u51fa\u4e00\u4e2a\u8bbe\u5907\u6240\u5728\u7684\u8bbe\u5907\u94fe\u6761\u3002\u5176\u4e2d\u5c31\u6709 U \u76d8\u7684 usb \u8bbe\u5907\u4fe1\u606f\u3002 <pre><code>$ udevadm info -a /dev/sda | grep 'looking at'\n  looking at device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1':\n  looking at parent device '/devices/pci0000:00':\n</code></pre></p>"},{"location":"software/qemu/tutorial-boot-iso-and-install/","title":"\u6559\u7a0b\uff1a\u4f7f\u7528 qemu \u5728\u7ec8\u7aef\u91cc\u5b89\u88c5\u548c\u8fd0\u884c\u865a\u62df\u673a","text":"<p>\u901a\u8fc7 ssh \u8fde\u63a5\u5230\u6ca1\u6709 GUI \u7684\u670d\u52a1\u5668\u65f6\uff0c\u9700\u8981\u5728\u7ec8\u7aef\u91cc\u5b89\u88c5\u548c\u8fd0\u884c qemu \u865a\u62df\u673a\u3002</p> <p>\u5728\u865a\u62df\u673a\u4f7f\u7528 UEFI \u56fa\u4ef6\u548c\u4f7f\u7528 BIOS \u56fa\u4ef6\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0cqemu \u542f\u52a8\u5b83\u4eec\u7684\u60c5\u51b5\u4f1a\u6709\u4e0d\u540c\uff0c\u8fd9\u5f71\u54cd\u9700\u8981\u4f7f\u7528\u7684 qemu \u53c2\u6570\u3002</p> <p>\u4e0b\u9762\u7684\u63cf\u8ff0\u57fa\u4e8e\u8fd9\u4e9b\u6761\u4ef6\uff1a</p> <ul> <li>\u865a\u62df\u673a\u4f7f\u7528 UEFI \u56fa\u4ef6\u7684\u60c5\u51b5\u3002</li> <li>\u8fd9\u662f\u5728 debian 12 \u7269\u7406\u673a\u4e0a\u6267\u884c\u7684\u64cd\u4f5c\u3002</li> </ul>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#_1","title":"\u5b89\u88c5\u8f6f\u4ef6\u5305","text":"<pre><code>sudo apt-get install qemu-system-x86 ovmf\n</code></pre>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#_2","title":"\u51c6\u5907\u865a\u62df\u673a\u6587\u4ef6","text":"<pre><code>MACHINE_NAME=\"one-vm\"\n# create an image file, format is qcow2.\nqemu-img create -f qcow2 \"${MACHINE_NAME}.cow\" 40G\n# copy the OVMF VARS file for UEFI usage (it stores UEFI variables).\n# this file is from package ovmf, debian.\ncp \"/usr/share/OVMF/OVMF_VARS_4M.ms.fd\" ./\n</code></pre>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#_3","title":"\u5728\u7ec8\u7aef\u5185\u542f\u52a8\u5b89\u88c5\u955c\u50cf","text":"<p>\u8fd9\u4e00\u6b65\u7684 qemu \u547d\u4ee4\u4f1a\u5728\u7ec8\u7aef\u4e2d\u542f\u52a8 <code>.iso</code> \u4e2d\u7684\u7cfb\u7edf\uff0c\u8fdb\u5165 grub \u754c\u9762\u3002</p> <pre><code>qemu-system-x86_64 \\\n    -machine q35,smm=on \\\n    -drive file=\"${MACHINE_NAME}.cow\",format=qcow2 \\\n    -global driver=cfi.pflash01,property=secure,value=on \\\n    -drive if=pflash,format=raw,unit=0,file=/usr/share/OVMF/OVMF_CODE_4M.ms.fd,readonly=on \\\n    -drive if=pflash,format=raw,unit=1,file=OVMF_VARS_4M.ms.fd \\\n    -cdrom debian-12.1.0-amd64-DVD-1.iso \\\n    -m 2G \\\n    -nic none \\\n    -nographic -serial mon:stdio -nodefaults\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>-nographic -serial mon:stdio -nodefaults</code> \u662f\u5173\u952e\u7684 qemu \u9009\u9879\uff0c\u5b83\u4eec\u4fdd\u8bc1\u865a\u62df\u673a\u80fd\u5728\u7ec8\u7aef\u91cc\u542f\u52a8\u548c\u663e\u793a\u6587\u5b57\u4fe1\u606f\uff0c\u800c\u4e0d\u9700\u8981\u4f7f\u7528\u56fe\u5f62\u754c\u9762\u3002</p> <p>\u5176\u5b83\u9009\u9879\uff1a</p> <ul> <li><code>-nic none</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u53ef\u4ee5\u7981\u7528\u865a\u62df\u673a\u7684\u7f51\u7edc\uff0c\u907f\u514d\u5728\u7cfb\u7edf\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4ece\u8f6f\u4ef6\u6e90\u4e0b\u8f7d\u548c\u5b89\u88c5\u66f4\u65b0\uff08\u8fd9\u53ef\u80fd\u6bd4\u8f83\u6162\uff09\u3002</li> </ul>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#grub","title":"\u5728 grub \u754c\u9762\u4e2d\u7ed9\u5185\u6838\u6dfb\u52a0\u542f\u52a8\u53c2\u6570","text":"<p>\u56e0\u4e3a\u5728 qemu \u547d\u4ee4\u884c\u4e2d\u9009\u62e9\u4e86 serial \u8bbe\u5907\u4f5c\u4e3a\u865a\u62df\u673a\u7cfb\u7edf\u7684\u663e\u793a\u754c\u9762\uff0c\u6240\u4ee5\u9700\u8981\u7ed9\u5185\u6838\u6dfb\u52a0 <code>console=ttyS0</code> \u53c2\u6570\u624d\u53ef\u4ee5\u8ba9\u7cfb\u7edf\u4f7f\u7528 serial \u8bbe\u5907\u4f5c\u4e3a\u8f93\u5165\u8f93\u51fa\u3002</p> <p>\u8fd9\u91cc\u7b80\u8981\u63cf\u8ff0\u6dfb\u52a0\u5185\u6838\u53c2\u6570\u7684\u6b65\u9aa4\u3002</p> <ol> <li>\u5728 grub \u663e\u793a\u7684\u83dc\u5355\u4e2d\uff0c\u6309 <code>E</code> \u6309\u952e\uff0c\u8fdb\u5165\u7f16\u8f91\u6a21\u5f0f\uff0c\u7f16\u8f91\u5f53\u524d\u7684\u83dc\u5355\u9009\u9879\u3002\uff08\u6309\u65b9\u5411\u952e\u79fb\u52a8\uff09</li> <li>\u5728\u6709 <code>linux</code> \u7684\u4e00\u884c\u4e2d\uff0c\u5728 <code>vmlinuz</code> \u540e\u6dfb\u52a0 <code>console=ttyS0</code> \u53c2\u6570\u3002</li> <li>\u6309 <code>Ctrl-X</code> \u4f7f\u7528\u4fee\u6539\u540e\u7684\u83dc\u5355\u9009\u9879\u542f\u52a8\u7cfb\u7edf\u3002</li> </ol> <p>\u4f8b\u5b50\uff1a\u4e0b\u9762\u662f\u4fee\u6539 <code>debian-12.1.0-amd64-DVD-1.iso</code> \u7684 grub \u83dc\u5355\u9009\u9879\u7684\u6548\u679c\u3002 grub \u7684 <code>Install</code> \u83dc\u5355\u9009\u9879\u5185\u5bb9\u4fee\u6539\u524d\uff1a <pre><code>setparams 'Install'\n\n    set background_color=black\n    linux    /install.amd/vmlinuz vga=788 --- quiet\n    initrd   /install.amd/initrd.gz\n</code></pre> \u5220\u6389 <code>vga=788</code> \u53c2\u6570\uff0c\u6dfb\u52a0 <code>console=ttyS0</code> \u53c2\u6570\uff0c\u5982\u4e0b\uff1a <pre><code>setparams 'Install'\n\n    set background_color=black\n    linux    /install.amd/vmlinuz console=ttyS0 --- quiet\n    initrd   /install.amd/initrd.gz\n</code></pre></p>"},{"location":"","title":"\u4e3b\u9875","text":"<p>\u8fd9\u91cc\u662f\u6211\u7684\u77e5\u8bc6\u5e93\u3002\u76ee\u524d\u8ba1\u5212\u8bb0\u5f55\u4e00\u4e9b\u5b9e\u8df5\u65b9\u9762\u7684\u77e5\u8bc6\u3002</p>"},{"location":"software/","title":"\u8f6f\u4ef6\u77e5\u8bc6","text":"<p>\u6709\u65f6\u5019\uff0c\u6211\u4f1a\u5fd8\u8bb0\u4e00\u4e9b\u8f6f\u4ef6\u7684\u4f7f\u7528\u65b9\u6cd5\u548c\u7ec6\u8282\u3002\u6211\u5e0c\u671b\u8bb0\u5f55\u4e00\u4e9b\u5185\u5bb9\uff0c\u4ee5\u65b9\u4fbf\u67e5\u627e\u3002</p>"},{"location":"software/qemu/passthrough-usb/","title":"\u7ed9 qemu \u865a\u62df\u673a\u76f4\u901a usb \u8bbe\u5907","text":"<p>\u7ed9 qemu \u865a\u62df\u673a\u76f4\u901a\u5bbf\u4e3b\u673a\u7684 usb \u8bbe\u5907\uff0c\u53ef\u4ee5\u8ba9\u865a\u62df\u673a\u76f4\u63a5\u8bbf\u95ee U \u76d8\u3001\u6444\u50cf\u5934\u7b49\u7269\u7406\u8bbe\u5907\u3002</p> <p>\u4e0b\u9762\u7684\u6b65\u9aa4\u63cf\u8ff0\u4e86\u7ed9\u865a\u62df\u673a\u76f4\u901a\u4e00\u4e2a U \u76d8\u7684\u8fc7\u7a0b\u3002</p> <ol> <li>\u83b7\u5f97 usb \u8bbe\u5907\u7684\u8bbf\u95ee\u6743\u9650<ol> <li>\u628a usb \u8bbe\u5907\u7684\u6240\u6709\u8005\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7528\u6237</li> <li>\u7528 root \u6743\u9650\u8fd0\u884c qemu</li> </ol> </li> <li>\u8bbe\u7f6e\u5408\u9002\u7684 qemu \u53c2\u6570\u5e76\u542f\u52a8\u865a\u62df\u673a</li> </ol> <p>\u5bf9\u4e8e\u6b65\u9aa4 1\uff0c\u4e0b\u9762\u9009\u62e9\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff1a\u627e\u5230 usb \u8bbe\u5907\u7684\u8def\u5f84\uff0c\u5e76\u628a\u6587\u4ef6\u7684\u6240\u6709\u8005\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7528\u6237\u3002</p>"},{"location":"software/qemu/passthrough-usb/#usb","title":"\u83b7\u5f97 usb \u8bbe\u5907\u7684\u8bbf\u95ee\u6743\u9650","text":""},{"location":"software/qemu/passthrough-usb/#u","title":"\u627e\u5230 U \u76d8\u7684\u8bbe\u5907\u8def\u5f84","text":"<p>\u5728 Linux \u4e0a\u63d2\u5165\u4e00\u4e2a U \u76d8\u65f6\uff0c\u4e00\u822c\u5bb9\u6613\u770b\u5230\u4e00\u4e2a\u65b0\u7684\u5757\u8bbe\u5907\uff0c\u6bd4\u5982 <code>/dev/sda</code> \u6216\u8005 <code>/dev/sdb</code>\u3002\u4f46\u662f\u8fd9\u5e76\u4e0d\u662f usb \u8bbe\u5907\u672c\u8eab\u3002</p> <p>\u901a\u8fc7 <code>lsusb</code> \u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u4e0a\u7684 usb \u8bbe\u5907\u7684\u4fe1\u606f\u3002 <pre><code>$ lsusb\nBus 007 Device 003: ID 17ef:608c Lenovo USB Keyboard\nBus 001 Device 004: ID 17ef:608d Lenovo Optical Mouse\nBus 001 Device 005: ID 0930:6544 Toshiba Corp. TransMemory-Mini XXX 2.0 Stick\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n</code></pre></p> <ul> <li>\u7531\u6b64\u53ef\u77e5\uff0cU \u76d8\u5728 bus 001\uff0cdevice 005 \u7684\u4f4d\u7f6e\u3002</li> <li>\u53ef\u4ee5\u5728 <code>/dev/bus/usb/</code> \u76ee\u5f55\u4e2d\u627e\u5230\u8fd9\u4e2a\u8bbe\u5907\uff0c\u5c31\u662f <code>/dev/bus/usb/001/005</code>\u3002\u901a\u8fc7 <code>udevadm info /dev/bus/usb/001/005</code> \u53ef\u4ee5\u786e\u8ba4\u8fd9\u4e2a\u8def\u5f84\u6307\u4ee3\u7684\u8bbe\u5907\u662f\u8fd9\u4e2a U \u76d8\u3002</li> <li>\u5728 ID <code>0930:6544</code> \u4e2d\uff0c<code>0930</code> \u662f U \u76d8\u7684 vendor id\uff0c<code>6544</code> \u662f product id\u3002</li> </ul>"},{"location":"software/qemu/passthrough-usb/#u_1","title":"\u8bbe\u7f6e U \u76d8\u8bbe\u5907\u7684\u6240\u6709\u8005","text":"<pre><code>sudo chown userAAA /dev/bus/usb/001/005\n</code></pre>"},{"location":"software/qemu/passthrough-usb/#qemu","title":"\u8bbe\u7f6e qemu \u53c2\u6570","text":"<p>\u4e3a\u4e86\u76f4\u901a\u524d\u8ff0 U \u76d8\u8bbe\u5907\uff0c\u5728 qemu \u547d\u4ee4\u4e2d\u6dfb\u52a0\u8fd9\u4e9b\u53c2\u6570 <pre><code>-usb -device usb-host,vendorid=0x0930,productid=0x6544\n</code></pre></p> <ul> <li><code>-usb</code>\uff1a\u4e3a\u865a\u62df\u673a\u5f00\u542f USB \u6a21\u62df\u529f\u80fd\u3002</li> <li><code>vendorid=0x0930,productid=0x6544</code>\uff1a\u4e0a\u9762\u627e\u5230\u4e86 U \u76d8\u7684 vendor id \u548c product id\uff0c\u4f9d\u6b21\u586b\u5165\u3002</li> </ul>"},{"location":"software/qemu/passthrough-usb/#_1","title":"\u66f4\u591a\u4fe1\u606f","text":""},{"location":"software/qemu/passthrough-usb/#devsda-usb","title":"\u63a2\u7d22\u5757\u8bbe\u5907 <code>/dev/sda</code> \u548c usb \u8bbe\u5907\u7684\u5173\u7cfb","text":"<p>\u5728\u7cfb\u7edf\u4e0a\u63d2\u5165\u4e00\u5757 U \u76d8\uff0c\u5bb9\u6613\u770b\u5230\u7c7b\u4f3c <code>/dev/sda</code> \u7684\u5757\u8bbe\u5907\u3002\u4ece\u5757\u8bbe\u5907\u53ef\u4ee5\u627e\u51fa usb \u8bbe\u5907\u7684\u4fe1\u606f\u3002</p> <p>\u901a\u8fc7 <code>udevadm info /dev/sda</code> \u53ef\u4ee5\u770b\u5230\u8bbe\u5907\u7684\u4fe1\u606f\u3002 <pre><code>$ udevadm info /dev/sda\nP: /devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda\nM: sda\nU: block\nT: disk\nD: b 8:0\nN: sda\nL: 0\nS: disk/by-id/usb-TOSHIBA_TransMemory_8BCAA96A7EEBCE80907A4D62-0:0\nS: disk/by-path/pci-0000:65:00.3-usb-0:1:1.0-scsi-0:0:0:0\nS: disk/by-diskseq/21\nQ: 21\nE: DEVPATH=/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda\nE: DEVNAME=/dev/sda\nE: DEVTYPE=disk\nE: DISKSEQ=21\nE: MAJOR=8\nE: MINOR=0\nE: SUBSYSTEM=block\n......\n</code></pre> \u4ece\u8bbe\u5907\u7684 path <code>/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda</code> \u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4e0e <code>usb1/1-1</code> \u6709\u5173\u7cfb\u3002</p> <p>\u901a\u8fc7 <code>udevadm info -a</code> \u53ef\u4ee5\u6253\u5370\u51fa\u4e00\u4e2a\u8bbe\u5907\u6240\u5728\u7684\u8bbe\u5907\u94fe\u6761\u3002\u5176\u4e2d\u5c31\u6709 U \u76d8\u7684 usb \u8bbe\u5907\u4fe1\u606f\u3002 <pre><code>$ udevadm info -a /dev/sda | grep 'looking at'\n  looking at device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0/block/sda':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0/0:0:0:0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0/target0:0:0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0/host0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1/1-1:1.0':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1/1-1':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3/usb1':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1/0000:65:00.3':\n  looking at parent device '/devices/pci0000:00/0000:00:08.1':\n  looking at parent device '/devices/pci0000:00':\n</code></pre></p>"},{"location":"software/qemu/tutorial-boot-iso-and-install/","title":"\u6559\u7a0b\uff1a\u4f7f\u7528 qemu \u5728\u7ec8\u7aef\u91cc\u5b89\u88c5\u548c\u8fd0\u884c\u865a\u62df\u673a","text":"<p>\u901a\u8fc7 ssh \u8fde\u63a5\u5230\u6ca1\u6709 GUI \u7684\u670d\u52a1\u5668\u65f6\uff0c\u9700\u8981\u5728\u7ec8\u7aef\u91cc\u5b89\u88c5\u548c\u8fd0\u884c qemu \u865a\u62df\u673a\u3002</p> <p>\u5728\u865a\u62df\u673a\u4f7f\u7528 UEFI \u56fa\u4ef6\u548c\u4f7f\u7528 BIOS \u56fa\u4ef6\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0cqemu \u542f\u52a8\u5b83\u4eec\u7684\u60c5\u51b5\u4f1a\u6709\u4e0d\u540c\uff0c\u8fd9\u5f71\u54cd\u9700\u8981\u4f7f\u7528\u7684 qemu \u53c2\u6570\u3002</p> <p>\u4e0b\u9762\u7684\u63cf\u8ff0\u57fa\u4e8e\u8fd9\u4e9b\u6761\u4ef6\uff1a</p> <ul> <li>\u865a\u62df\u673a\u4f7f\u7528 UEFI \u56fa\u4ef6\u7684\u60c5\u51b5\u3002</li> <li>\u8fd9\u662f\u5728 debian 12 \u7269\u7406\u673a\u4e0a\u6267\u884c\u7684\u64cd\u4f5c\u3002</li> </ul>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#_1","title":"\u5b89\u88c5\u8f6f\u4ef6\u5305","text":"<pre><code>sudo apt-get install qemu-system-x86 ovmf\n</code></pre>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#_2","title":"\u51c6\u5907\u865a\u62df\u673a\u6587\u4ef6","text":"<pre><code>MACHINE_NAME=\"one-vm\"\n# create an image file, format is qcow2.\nqemu-img create -f qcow2 \"${MACHINE_NAME}.cow\" 40G\n# copy the OVMF VARS file for UEFI usage (it stores UEFI variables).\n# this file is from package ovmf, debian.\ncp \"/usr/share/OVMF/OVMF_VARS_4M.ms.fd\" ./\n</code></pre>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#_3","title":"\u5728\u7ec8\u7aef\u5185\u542f\u52a8\u5b89\u88c5\u955c\u50cf","text":"<p>\u8fd9\u4e00\u6b65\u7684 qemu \u547d\u4ee4\u4f1a\u5728\u7ec8\u7aef\u4e2d\u542f\u52a8 <code>.iso</code> \u4e2d\u7684\u7cfb\u7edf\uff0c\u8fdb\u5165 grub \u754c\u9762\u3002</p> <pre><code>qemu-system-x86_64 \\\n    -machine q35,smm=on \\\n    -drive file=\"${MACHINE_NAME}.cow\",format=qcow2 \\\n    -global driver=cfi.pflash01,property=secure,value=on \\\n    -drive if=pflash,format=raw,unit=0,file=/usr/share/OVMF/OVMF_CODE_4M.ms.fd,readonly=on \\\n    -drive if=pflash,format=raw,unit=1,file=OVMF_VARS_4M.ms.fd \\\n    -cdrom debian-12.1.0-amd64-DVD-1.iso \\\n    -m 2G \\\n    -nic none \\\n    -nographic -serial mon:stdio -nodefaults\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>-nographic -serial mon:stdio -nodefaults</code> \u662f\u5173\u952e\u7684 qemu \u9009\u9879\uff0c\u5b83\u4eec\u4fdd\u8bc1\u865a\u62df\u673a\u80fd\u5728\u7ec8\u7aef\u91cc\u542f\u52a8\u548c\u663e\u793a\u6587\u5b57\u4fe1\u606f\uff0c\u800c\u4e0d\u9700\u8981\u4f7f\u7528\u56fe\u5f62\u754c\u9762\u3002</p> <p>\u5176\u5b83\u9009\u9879\uff1a</p> <ul> <li><code>-nic none</code>\uff1a\u8fd9\u4e2a\u9009\u9879\u53ef\u4ee5\u7981\u7528\u865a\u62df\u673a\u7684\u7f51\u7edc\uff0c\u907f\u514d\u5728\u7cfb\u7edf\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4ece\u8f6f\u4ef6\u6e90\u4e0b\u8f7d\u548c\u5b89\u88c5\u66f4\u65b0\uff08\u8fd9\u53ef\u80fd\u6bd4\u8f83\u6162\uff09\u3002</li> </ul>"},{"location":"software/qemu/tutorial-boot-iso-and-install/#grub","title":"\u5728 grub \u754c\u9762\u4e2d\u7ed9\u5185\u6838\u6dfb\u52a0\u542f\u52a8\u53c2\u6570","text":"<p>\u56e0\u4e3a\u5728 qemu \u547d\u4ee4\u884c\u4e2d\u9009\u62e9\u4e86 serial \u8bbe\u5907\u4f5c\u4e3a\u865a\u62df\u673a\u7cfb\u7edf\u7684\u663e\u793a\u754c\u9762\uff0c\u6240\u4ee5\u9700\u8981\u7ed9\u5185\u6838\u6dfb\u52a0 <code>console=ttyS0</code> \u53c2\u6570\u624d\u53ef\u4ee5\u8ba9\u7cfb\u7edf\u4f7f\u7528 serial \u8bbe\u5907\u4f5c\u4e3a\u8f93\u5165\u8f93\u51fa\u3002</p> <p>\u8fd9\u91cc\u7b80\u8981\u63cf\u8ff0\u6dfb\u52a0\u5185\u6838\u53c2\u6570\u7684\u6b65\u9aa4\u3002</p> <ol> <li>\u5728 grub \u663e\u793a\u7684\u83dc\u5355\u4e2d\uff0c\u6309 <code>E</code> \u6309\u952e\uff0c\u8fdb\u5165\u7f16\u8f91\u6a21\u5f0f\uff0c\u7f16\u8f91\u5f53\u524d\u7684\u83dc\u5355\u9009\u9879\u3002\uff08\u6309\u65b9\u5411\u952e\u79fb\u52a8\uff09</li> <li>\u5728\u6709 <code>linux</code> \u7684\u4e00\u884c\u4e2d\uff0c\u5728 <code>vmlinuz</code> \u540e\u6dfb\u52a0 <code>console=ttyS0</code> \u53c2\u6570\u3002</li> <li>\u6309 <code>Ctrl-X</code> \u4f7f\u7528\u4fee\u6539\u540e\u7684\u83dc\u5355\u9009\u9879\u542f\u52a8\u7cfb\u7edf\u3002</li> </ol> <p>\u4f8b\u5b50\uff1a\u4e0b\u9762\u662f\u4fee\u6539 <code>debian-12.1.0-amd64-DVD-1.iso</code> \u7684 grub \u83dc\u5355\u9009\u9879\u7684\u6548\u679c\u3002 grub \u7684 <code>Install</code> \u83dc\u5355\u9009\u9879\u5185\u5bb9\u4fee\u6539\u524d\uff1a <pre><code>setparams 'Install'\n\n    set background_color=black\n    linux    /install.amd/vmlinuz vga=788 --- quiet\n    initrd   /install.amd/initrd.gz\n</code></pre> \u5220\u6389 <code>vga=788</code> \u53c2\u6570\uff0c\u6dfb\u52a0 <code>console=ttyS0</code> \u53c2\u6570\uff0c\u5982\u4e0b\uff1a <pre><code>setparams 'Install'\n\n    set background_color=black\n    linux    /install.amd/vmlinuz console=ttyS0 --- quiet\n    initrd   /install.amd/initrd.gz\n</code></pre></p>"}]}